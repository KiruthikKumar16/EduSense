<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduSense - AI-Powered Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background: #2563eb;
        }
        .spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="gradient-bg text-white p-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <h1 class="text-2xl font-bold">üéì EduSense</h1>
                <span class="ml-2 text-sm opacity-75">AI-Powered Learning</span>
            </div>
            <div class="flex space-x-4">
                <button onclick="showSection('dashboard')" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">Dashboard</button>
                <button onclick="showSection('topics')" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">Topics</button>
                <button onclick="showSection('quizzes')" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">Quizzes</button>
                <button onclick="showSection('ai-demo')" class="hover:bg-white hover:bg-opacity-20 px-3 py-2 rounded">AI Demo</button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto p-6">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Dashboard</h2>
                <p class="text-gray-600">Your learning progress and AI-powered insights</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="card">
                    <div class="flex items-center">
                        <div class="p-3 bg-blue-100 rounded-lg">
                            <span class="text-2xl">üìä</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Overall Performance</p>
                            <p class="text-2xl font-bold text-gray-900" id="overall-score">75%</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="flex items-center">
                        <div class="p-3 bg-green-100 rounded-lg">
                            <span class="text-2xl">üìö</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Topics Studied</p>
                            <p class="text-2xl font-bold text-gray-900" id="topics-studied">5</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="flex items-center">
                        <div class="p-3 bg-purple-100 rounded-lg">
                            <span class="text-2xl">‚è±Ô∏è</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Study Time</p>
                            <p class="text-2xl font-bold text-gray-900" id="study-time">1h</p>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="flex items-center">
                        <div class="p-3 bg-yellow-100 rounded-lg">
                            <span class="text-2xl">üéØ</span>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm text-gray-500">Learning Paths</p>
                            <p class="text-2xl font-bold text-gray-900" id="learning-paths">2</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                    <div id="recent-activity" class="space-y-3">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <h3 class="text-lg font-semibold mb-4">AI Recommendations</h3>
                    <div id="ai-recommendations" class="space-y-3">
                        <!-- Recommendations will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Topics Section -->
        <div id="topics-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Topics</h2>
                <p class="text-gray-600">Explore educational topics and start learning</p>
            </div>
            <div id="topics-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Topics will be loaded here -->
            </div>
        </div>

        <!-- Quizzes Section -->
        <div id="quizzes-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Quizzes</h2>
                <p class="text-gray-600">Test your knowledge with AI-generated quizzes</p>
            </div>
            <div id="quizzes-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Quizzes will be loaded here -->
            </div>
        </div>

        <!-- AI Demo Section -->
        <div id="ai-demo-section" class="section hidden">
            <div class="mb-6">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">AI Demo</h2>
                <p class="text-gray-600">Experience AI-powered content generation</p>
            </div>
            <div class="card">
                <h3 class="text-lg font-semibold mb-4">Generate AI Quiz</h3>
                <button onclick="generateAIQuiz()" class="btn-primary mb-4">
                    <span id="ai-loading" class="hidden">
                        <div class="spinner inline-block mr-2"></div>
                    </span>
                    Generate Quiz with Gemini AI
                </button>
                <div id="ai-quiz-result" class="hidden">
                    <!-- AI generated quiz will appear here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        // Show/hide sections
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Load data for the section
            if (sectionName === 'dashboard') {
                loadDashboard();
            } else if (sectionName === 'topics') {
                loadTopics();
            } else if (sectionName === 'quizzes') {
                loadQuizzes();
            }
        }

        // Load dashboard data
        async function loadDashboard() {
            try {
                const response = await axios.get(`${API_BASE}/api/analytics/dashboard`);
                const data = response.data.data;
                
                // Update stats
                document.getElementById('overall-score').textContent = data.user_performance.average_score + '%';
                document.getElementById('topics-studied').textContent = data.user_performance.total_topics_studied;
                document.getElementById('study-time').textContent = Math.round(data.user_performance.total_time_spent / 3600) + 'h';
                document.getElementById('learning-paths').textContent = data.learning_progress.active_paths;
                
                // Update recent activity
                const activityHtml = data.recent_activities.map(activity => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium">${activity.title}</p>
                            <p class="text-sm text-gray-500">${activity.topic}</p>
                        </div>
                        <span class="px-2 py-1 rounded text-sm ${activity.status === 'passed' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${activity.score}%
                        </span>
                    </div>
                `).join('');
                document.getElementById('recent-activity').innerHTML = activityHtml;
                
                // Update recommendations
                const recommendationsHtml = data.recommendations.map(rec => `
                    <div class="flex items-start p-3 bg-blue-50 rounded-lg">
                        <span class="text-blue-600 mr-2">üí°</span>
                        <p class="text-sm text-gray-700">${rec}</p>
                    </div>
                `).join('');
                document.getElementById('ai-recommendations').innerHTML = recommendationsHtml;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Load topics
        async function loadTopics() {
            try {
                const response = await axios.get(`${API_BASE}/api/content/topics`);
                const topics = response.data;
                
                const topicsHtml = topics.map(topic => `
                    <div class="card hover:shadow-lg transition-shadow">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">${topic.name}</h3>
                                <p class="text-sm text-gray-600 mb-3">${topic.description}</p>
                            </div>
                            <span class="px-2 py-1 rounded text-xs ${topic.difficulty_level === 'easy' ? 'bg-green-100 text-green-800' : topic.difficulty_level === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${topic.difficulty_level}
                            </span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-500">
                                <span class="mr-2">üìö</span>
                                ${topic.subject}
                            </div>
                            <div class="flex items-center text-sm text-gray-500">
                                <span class="mr-2">üë•</span>
                                ${topic.grade_level}
                            </div>
                        </div>
                        <button class="btn-primary w-full">Start Learning</button>
                    </div>
                `).join('');
                
                document.getElementById('topics-grid').innerHTML = topicsHtml;
            } catch (error) {
                console.error('Error loading topics:', error);
            }
        }

        // Load quizzes
        async function loadQuizzes() {
            try {
                const response = await axios.get(`${API_BASE}/api/quizzes/`);
                const quizzes = response.data;
                
                const quizzesHtml = quizzes.map(quiz => `
                    <div class="card hover:shadow-lg transition-shadow">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">${quiz.title}</h3>
                        <p class="text-sm text-gray-600 mb-4">${quiz.description}</p>
                        <div class="flex items-center justify-between">
                            <span class="px-2 py-1 rounded text-xs ${quiz.difficulty_level === 'easy' ? 'bg-green-100 text-green-800' : quiz.difficulty_level === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">
                                ${quiz.difficulty_level}
                            </span>
                            <button class="btn-primary">Take Quiz</button>
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('quizzes-grid').innerHTML = quizzesHtml;
            } catch (error) {
                console.error('Error loading quizzes:', error);
            }
        }

        // Generate AI Quiz
        async function generateAIQuiz() {
            const loadingEl = document.getElementById('ai-loading');
            const resultEl = document.getElementById('ai-quiz-result');
            
            loadingEl.classList.remove('hidden');
            
            try {
                const response = await axios.post(`${API_BASE}/api/ai/generate-quiz`);
                const quizData = response.data.quiz_data;
                
                const quizHtml = `
                    <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">${quizData.title}</h4>
                        <p class="text-sm text-green-700 mb-3">${quizData.description}</p>
                        <div class="space-y-3">
                            ${quizData.questions.map(q => `
                                <div class="p-3 bg-white rounded border">
                                    <p class="font-medium mb-2">${q.question_text}</p>
                                    <div class="space-y-1">
                                        ${q.options.map(option => `
                                            <label class="flex items-center">
                                                <input type="radio" name="q${q.question_text}" value="${option}" class="mr-2">
                                                ${option}
                                            </label>
                                        `).join('')}
                                    </div>
                                    <p class="text-sm text-gray-600 mt-2">Answer: ${q.correct_answer}</p>
                                    <p class="text-sm text-gray-500">${q.explanation}</p>
                                </div>
                            `).join('')}
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Generated by: ${response.data.generated_by}</p>
                    </div>
                `;
                
                resultEl.innerHTML = quizHtml;
                resultEl.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error generating AI quiz:', error);
                resultEl.innerHTML = '<div class="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800">Error generating quiz. Please try again.</div>';
                resultEl.classList.remove('hidden');
            } finally {
                loadingEl.classList.add('hidden');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
        });
    </script>
</body>
</html>
